"""Unit tests for analyzing CFPT (OrderSort) data
"""
#pylint: disable=import-outside-toplevel
from unittest import TestCase
from io import StringIO
import pandas


class CfptScoreTests(TestCase):
    """Unit tests for score_cfpt
    """
    N_TRIALS = 16

    def test_score(self):
        """score_cfpt() adds the trial-wise "score" column
        and a total score
        """
        from meadows.cfpt import score_cfpt
        fdata = StringIO(DATA)
        annotations = pandas.read_csv(fdata)
        out_df = score_cfpt(annotations)
        self.assertEqual(len(out_df), 32)
        # first participant, first trial
        wittyWorm_1 = out_df.iloc[0]
        self.assertEqual(wittyWorm_1.participation, 'witty-worm')
        self.assertEqual(wittyWorm_1.identity, 52)
        self.assertEqual(wittyWorm_1.condition, 'inv')
        self.assertEqual(wittyWorm_1.n_moves, 11)
        self.assertEqual(wittyWorm_1.rt, 60.033)
        self.assertEqual(wittyWorm_1.deviations, 6)
        self.assertAlmostEqual(wittyWorm_1.score, 66.67, places=2)


DATA = """
task,participation,start,resp,label,stim1_id,stim1_name,stim2_id,stim2_name,stim3_id,stim3_name,stim4_id,stim4_name,stim5_id,stim5_name,stim6_id,stim6_name,stim7_id,stim7_name
cfpt_main,witty-worm,2022-11-16T18:23:48.270Z,2022-11-16T18:24:48.303Z,11_inv_52_12-inv_52_48-inv_52_24-inv_52_60-inv_52_36-inv_52_72,fec56c122489cf67600f6106aff13716,inv_52_00,6dd7b60641400a9b35151074c56ddc7d,inv_52_48,238b3dc38cd652d68f8b0332782700f2,inv_52_12,d0688d067cd414e8cce79e859eeef0ee,inv_52_36,56ce30d660481689ef587222c4cdf55f,inv_52_60,8e69145c16325e0e800667f9ff393b5e,inv_52_24,d28c5ccc31d253526e476aa5df6e860b,inv_52_72
cfpt_main,witty-worm,2022-11-16T18:24:48.308Z,2022-11-16T18:25:48.348Z,29_inv_47_24-inv_47_12-inv_47_36-inv_47_60-inv_47_72-inv_47_48,52dea75211e1f9ee696aa0adf52ea8f4,inv_47_00,6e2839bab5dec82cda249a805c4b45e9,inv_47_36,97c7c3ed1f353d19b8296ff2fd265b0d,inv_47_48,f4be2d6d88327801755a99ffd7cb6903,inv_47_24,2fc11d35a4f1fdb30c4861712e6e0f95,inv_47_12,52c6b96a31328eeacfdbd8e89d75d44f,inv_47_72,729980bdfaa36b8e0fc467b2f50eb662,inv_47_60
cfpt_main,witty-worm,2022-11-16T18:25:48.356Z,2022-11-16T18:26:34.801Z,23_ere_21_12-ere_21_24-ere_21_36-ere_21_48-ere_21_60-ere_21_72,304f02c746c5618f957710bffd4387aa,ere_21_00,533c0a5c1685701161444daa46397972,ere_21_24,e8f56979f4a24f51148a47365fc52cb2,ere_21_60,d8e4a29f0f6b0bfef7d3487ab72261bb,ere_21_48,f88c147a3b4c6af3f0889523d7733c89,ere_21_36,f93c9afad363f3ee8c99c38a5c42508b,ere_21_72,ffaf1ed08b9cbeb844dd2db02821d31d,ere_21_12
cfpt_main,witty-worm,2022-11-16T18:26:34.817Z,2022-11-16T18:27:28.150Z,21_ere_67_12-ere_67_36-ere_67_24-ere_67_48-ere_67_72-ere_67_60,3f6c8864b4c784211f2151c8377f007b,ere_67_00,059ba1f1ff5851399b7484a6827f942b,ere_67_24,310b3cec9735f7bb991e595485cb53fb,ere_67_60,92ce9d28b21198a476412955593187b8,ere_67_72,117d22fc47f782411aac179c469dcfde,ere_67_48,3c3796d5f0a97d7103454b562dfc44a6,ere_67_36,41b5f36add15a431c556708c37b8ec2a,ere_67_12
cfpt_main,witty-worm,2022-11-16T18:27:28.156Z,2022-11-16T18:28:10.158Z,10_inv_48_72-inv_48_12-inv_48_60-inv_48_24-inv_48_48-inv_48_36,345cfc4a9c0ce5efc8ca9e1f05d9224d,inv_48_00,f1e4e7e7cd122deaeec7b809cbb1117d,inv_48_24,239f853b1bb30a5647835e22042dabc5,inv_48_12,045c98370a00a1d5a063596d827847ea,inv_48_48,f326b213f85d2cfddd9ae1077e70b0f4,inv_48_72,20d84a138cc8b961ccdf1037edd0226b,inv_48_36,f180d58249cb28fd51d2e27b4a52d23f,inv_48_60
cfpt_main,witty-worm,2022-11-16T18:28:10.161Z,2022-11-16T18:29:10.208Z,20_ere_02_60-ere_02_24-ere_02_72-ere_02_36-ere_02_12-ere_02_48,f7e956085c0a12af183f3bd4f8ac9938,ere_02_00,4db17a174f64fbeaba1a624506d02ad9,ere_02_36,c56d38f14c6556a0413d6b07f46c2d17,ere_02_12,5ea0256c3c1a97a4f865fff137eb6dc1,ere_02_24,e541e5bf517b7e4070c2804fb3bd57a8,ere_02_60,57c530d65aa121f3a3022b9f03d98265,ere_02_72,c723c74f6c20849ed79d387c85992bb7,ere_02_48
cfpt_main,witty-worm,2022-11-16T18:29:10.213Z,2022-11-16T18:29:39.265Z,15_ere_52_36-ere_52_12-ere_52_24-ere_52_72-ere_52_60-ere_52_48,c2e28ee8936c09cdf8808615509ada78,ere_52_00,5cabdd060c72d00c9689f4bba8405f84,ere_52_72,6883109d870559a24f64af484033ba6f,ere_52_60,62f40abfbf13244c61b0642f1b3bf54c,ere_52_48,c29357de670dcfd3bcf418c33fd08157,ere_52_24,d0c8b5db9d93018e5440584a7330e98b,ere_52_12,71bcb673489d903e3f8c1f263933f27b,ere_52_36
cfpt_main,witty-worm,2022-11-16T18:29:39.268Z,2022-11-16T18:30:14.316Z,9_ere_68_48-ere_68_24-ere_68_12-ere_68_36-ere_68_60-ere_68_72,b9bc447bd809e35cf68b8e5eacb48e40,ere_68_00,91db106f71d4c1ed9626722d0a7b2f64,ere_68_24,77178378c97d8a0a0099ed21f3ccf396,ere_68_12,d84d45156dc8a6917d14a1202c38bd22,ere_68_36,6b504e8fa9ac292ad0926c47c26276da,ere_68_60,36e47f6a3d735e8cb0279818d783b01a,ere_68_48,a22fecf70342f73be4820b595e1fccb7,ere_68_72
cfpt_main,witty-worm,2022-11-16T18:30:14.324Z,2022-11-16T18:31:01.125Z,28_ere_61_12-ere_61_36-ere_61_48-ere_61_60-ere_61_24-ere_61_72,38981022817f2b68e5bb5ec6dc8d64d6,ere_61_00,d75f94a61df655ecd7fedee966ea0448,ere_61_72,91650bf52c93bbfb898bb1e3f16d8621,ere_61_36,a2b01509fb4ec76afca31d36d1e317d6,ere_61_12,2d7275f4913f74bfbc7b3af0ed017a78,ere_61_48,58ce5e418a446a542e7cde0d60de1941,ere_61_60,42bfda4a99f2351ad94c0d617238e32a,ere_61_24
cfpt_main,witty-worm,2022-11-16T18:31:01.136Z,2022-11-16T18:31:56.594Z,26_inv_21_48-inv_21_24-inv_21_36-inv_21_72-inv_21_12-inv_21_60,e659f29317ace3abe789395cb9c6fe63,inv_21_00,120cd5377cfcc48fe80787386bb1bcc2,inv_21_36,950995dbe8140f5239df5eb411817c6c,inv_21_72,810881a31f8269e2ddd3b098fe1a323a,inv_21_12,9d933d5022bb011734517c99c114b28e,inv_21_24,3682d8b1b9cc7fa16ea93ca1580c6b71,inv_21_60,8d48ed1281e5c31d869aef22d3c8be3d,inv_21_48
cfpt_main,witty-worm,2022-11-16T18:31:56.605Z,2022-11-16T18:32:20.287Z,9_inv_61_12-inv_61_48-inv_61_60-inv_61_24-inv_61_36-inv_61_72,304031f7a5ce6bffcd6eb67d9d9e3444,inv_61_00,5fa41e60976214d5d6540df61a9d0ca8,inv_61_60,77ce46148db468582aadf4f515387906,inv_61_24,4907f3a16a65ab5ffae45c170e0e8f34,inv_61_48,bf81351dad582f3b51512098de80617b,inv_61_12,525fc04ccd8166ae3b30f8254438a45c,inv_61_72,856aae3324f4cbb72842ecc753f926aa,inv_61_36
cfpt_main,witty-worm,2022-11-16T18:32:20.290Z,2022-11-16T18:32:54.194Z,14_inv_02_12-inv_02_48-inv_02_24-inv_02_60-inv_02_36-inv_02_72,b2e2b1a594a188e3e92b977e9949f17d,inv_02_00,f42398b33d58c66b41c99b99223db96f,inv_02_72,d8d00bc75477885de2a1ca083b917767,inv_02_24,959792bc94e58893af18e8118f1927b0,inv_02_60,bf6548f28b1f944922754b9150fbc7a2,inv_02_12,06b067cf5bfdd4212af4421d84ec99d8,inv_02_48,cc4df0c916cf89ea77d8c7a9b68be624,inv_02_36
cfpt_main,witty-worm,2022-11-16T18:32:54.197Z,2022-11-16T18:33:32.288Z,20_ere_48_12-ere_48_36-ere_48_24-ere_48_48-ere_48_72-ere_48_60,6f957c279b0a29d9444c74930bbbe025,ere_48_00,84bb360a5a89528da41afd338f0fc788,ere_48_72,d9444c70bd1e98e1837ca74ee66e7be8,ere_48_48,4d22d7e83c03eac843664f96da8f744e,ere_48_60,4a32c86b56b295f87f14c483a22158b0,ere_48_12,e70dd6e18188e1134ad4774ae940c48b,ere_48_24,bca92d047c05b0d318caf2ddf10a562b,ere_48_36
cfpt_main,witty-worm,2022-11-16T18:33:32.296Z,2022-11-16T18:34:03.213Z,16_inv_68_12-inv_68_24-inv_68_72-inv_68_36-inv_68_48-inv_68_60,91607df74d16adc4ee500d501e0d20ca,inv_68_00,59fb3d483d2ad97329341ac968e37faa,inv_68_36,e5f21b20e0b3982ae4949c49356ca066,inv_68_72,1253a400f543c06836257e22c883aff3,inv_68_60,f14f0cba8f4749ae792de37db7babe54,inv_68_48,b06e989d8bd4c51e00cb2f824737e1dc,inv_68_12,8e64c3fbdcd5316051d71cd042a2039b,inv_68_24
cfpt_main,witty-worm,2022-11-16T18:34:03.219Z,2022-11-16T18:34:42.587Z,15_ere_47_12-ere_47_24-ere_47_72-ere_47_60-ere_47_36-ere_47_48,31c10250c0393a89b1c3064743d83f6b,ere_47_00,550ce514a4ce2757969390d45ccfc2c0,ere_47_12,a9a0f18a157a9db5f90d9a6dc6e6dcd7,ere_47_36,649f4c16a2f22b15641c7b3065bce360,ere_47_48,97621322ef93790d8e8fc04c7f76cacf,ere_47_60,b3beadc77a5a686a1359add537a6ea67,ere_47_24,ebf6ae55cd71ce68048995fa07166d3e,ere_47_72
cfpt_main,witty-worm,2022-11-16T18:34:42.594Z,2022-11-16T18:35:18.679Z,17_inv_67_12-inv_67_48-inv_67_36-inv_67_72-inv_67_24-inv_67_60,3a9dc4f8dc6f103271d5455533834760,inv_67_00,50079f16d2dc6e79ed9a8d901538c479,inv_67_72,90481f1bd71a25b6ef4038b6d66f331f,inv_67_12,2f249441da202e1f9aa8888771bc1783,inv_67_60,3d228248d7eff46cbbf04ebffdee0916,inv_67_24,0cdfbee6670b35ddd4f5abf7fc8898ca,inv_67_48,7cdd604ff639f71d39bf478eeb3bf0d1,inv_67_36
cfpt_main,modern-goblin,2022-11-16T21:09:04.418Z,2022-11-16T21:09:51.686Z,10_inv_48_12-inv_48_24-inv_48_36-inv_48_48-inv_48_72-inv_48_60,345cfc4a9c0ce5efc8ca9e1f05d9224d,inv_48_00,f1e4e7e7cd122deaeec7b809cbb1117d,inv_48_24,239f853b1bb30a5647835e22042dabc5,inv_48_12,045c98370a00a1d5a063596d827847ea,inv_48_48,f326b213f85d2cfddd9ae1077e70b0f4,inv_48_72,20d84a138cc8b961ccdf1037edd0226b,inv_48_36,f180d58249cb28fd51d2e27b4a52d23f,inv_48_60
cfpt_main,modern-goblin,2022-11-16T21:09:51.687Z,2022-11-16T21:10:08.395Z,15_ere_21_24-ere_21_12-ere_21_36-ere_21_48-ere_21_60-ere_21_72,304f02c746c5618f957710bffd4387aa,ere_21_00,533c0a5c1685701161444daa46397972,ere_21_24,e8f56979f4a24f51148a47365fc52cb2,ere_21_60,d8e4a29f0f6b0bfef7d3487ab72261bb,ere_21_48,f88c147a3b4c6af3f0889523d7733c89,ere_21_36,f93c9afad363f3ee8c99c38a5c42508b,ere_21_72,ffaf1ed08b9cbeb844dd2db02821d31d,ere_21_12
cfpt_main,modern-goblin,2022-11-16T21:10:08.397Z,2022-11-16T21:10:42.991Z,26_ere_67_72-ere_67_48-ere_67_36-ere_67_12-ere_67_60-ere_67_24,3f6c8864b4c784211f2151c8377f007b,ere_67_00,059ba1f1ff5851399b7484a6827f942b,ere_67_24,310b3cec9735f7bb991e595485cb53fb,ere_67_60,92ce9d28b21198a476412955593187b8,ere_67_72,117d22fc47f782411aac179c469dcfde,ere_67_48,3c3796d5f0a97d7103454b562dfc44a6,ere_67_36,41b5f36add15a431c556708c37b8ec2a,ere_67_12
cfpt_main,modern-goblin,2022-11-16T21:10:42.992Z,2022-11-16T21:11:25.099Z,21_inv_68_12-inv_68_24-inv_68_72-inv_68_60-inv_68_48-inv_68_36,91607df74d16adc4ee500d501e0d20ca,inv_68_00,59fb3d483d2ad97329341ac968e37faa,inv_68_36,e5f21b20e0b3982ae4949c49356ca066,inv_68_72,1253a400f543c06836257e22c883aff3,inv_68_60,f14f0cba8f4749ae792de37db7babe54,inv_68_48,b06e989d8bd4c51e00cb2f824737e1dc,inv_68_12,8e64c3fbdcd5316051d71cd042a2039b,inv_68_24
cfpt_main,modern-goblin,2022-11-16T21:11:25.100Z,2022-11-16T21:11:53.909Z,32_ere_47_72-ere_47_60-ere_47_12-ere_47_24-ere_47_36-ere_47_48,31c10250c0393a89b1c3064743d83f6b,ere_47_00,550ce514a4ce2757969390d45ccfc2c0,ere_47_12,a9a0f18a157a9db5f90d9a6dc6e6dcd7,ere_47_36,649f4c16a2f22b15641c7b3065bce360,ere_47_48,97621322ef93790d8e8fc04c7f76cacf,ere_47_60,b3beadc77a5a686a1359add537a6ea67,ere_47_24,ebf6ae55cd71ce68048995fa07166d3e,ere_47_72
cfpt_main,modern-goblin,2022-11-16T21:11:53.910Z,2022-11-16T21:12:32.276Z,15_inv_21_12-inv_21_24-inv_21_36-inv_21_48-inv_21_60-inv_21_72,e659f29317ace3abe789395cb9c6fe63,inv_21_00,120cd5377cfcc48fe80787386bb1bcc2,inv_21_36,950995dbe8140f5239df5eb411817c6c,inv_21_72,810881a31f8269e2ddd3b098fe1a323a,inv_21_12,9d933d5022bb011734517c99c114b28e,inv_21_24,3682d8b1b9cc7fa16ea93ca1580c6b71,inv_21_60,8d48ed1281e5c31d869aef22d3c8be3d,inv_21_48
cfpt_main,modern-goblin,2022-11-16T21:12:32.278Z,2022-11-16T21:12:53.012Z,23_ere_52_12-ere_52_24-ere_52_36-ere_52_48-ere_52_72-ere_52_60,c2e28ee8936c09cdf8808615509ada78,ere_52_00,5cabdd060c72d00c9689f4bba8405f84,ere_52_72,6883109d870559a24f64af484033ba6f,ere_52_60,62f40abfbf13244c61b0642f1b3bf54c,ere_52_48,c29357de670dcfd3bcf418c33fd08157,ere_52_24,d0c8b5db9d93018e5440584a7330e98b,ere_52_12,71bcb673489d903e3f8c1f263933f27b,ere_52_36
cfpt_main,modern-goblin,2022-11-16T21:12:53.013Z,2022-11-16T21:13:42.389Z,12_inv_52_36-inv_52_60-inv_52_24-inv_52_48-inv_52_12-inv_52_72,fec56c122489cf67600f6106aff13716,inv_52_00,6dd7b60641400a9b35151074c56ddc7d,inv_52_48,238b3dc38cd652d68f8b0332782700f2,inv_52_12,d0688d067cd414e8cce79e859eeef0ee,inv_52_36,56ce30d660481689ef587222c4cdf55f,inv_52_60,8e69145c16325e0e800667f9ff393b5e,inv_52_24,d28c5ccc31d253526e476aa5df6e860b,inv_52_72
cfpt_main,modern-goblin,2022-11-16T21:13:42.390Z,2022-11-16T21:14:04.491Z,17_ere_02_24-ere_02_72-ere_02_12-ere_02_36-ere_02_48-ere_02_60,f7e956085c0a12af183f3bd4f8ac9938,ere_02_00,4db17a174f64fbeaba1a624506d02ad9,ere_02_36,c56d38f14c6556a0413d6b07f46c2d17,ere_02_12,5ea0256c3c1a97a4f865fff137eb6dc1,ere_02_24,e541e5bf517b7e4070c2804fb3bd57a8,ere_02_60,57c530d65aa121f3a3022b9f03d98265,ere_02_72,c723c74f6c20849ed79d387c85992bb7,ere_02_48
cfpt_main,modern-goblin,2022-11-16T21:14:04.492Z,2022-11-16T21:14:36.567Z,12_inv_47_24-inv_47_60-inv_47_12-inv_47_36-inv_47_48-inv_47_72,52dea75211e1f9ee696aa0adf52ea8f4,inv_47_00,6e2839bab5dec82cda249a805c4b45e9,inv_47_36,97c7c3ed1f353d19b8296ff2fd265b0d,inv_47_48,f4be2d6d88327801755a99ffd7cb6903,inv_47_24,2fc11d35a4f1fdb30c4861712e6e0f95,inv_47_12,52c6b96a31328eeacfdbd8e89d75d44f,inv_47_72,729980bdfaa36b8e0fc467b2f50eb662,inv_47_60
cfpt_main,modern-goblin,2022-11-16T21:14:36.568Z,2022-11-16T21:14:59.978Z,18_ere_68_48-ere_68_24-ere_68_36-ere_68_60-ere_68_12-ere_68_72,b9bc447bd809e35cf68b8e5eacb48e40,ere_68_00,91db106f71d4c1ed9626722d0a7b2f64,ere_68_24,77178378c97d8a0a0099ed21f3ccf396,ere_68_12,d84d45156dc8a6917d14a1202c38bd22,ere_68_36,6b504e8fa9ac292ad0926c47c26276da,ere_68_60,36e47f6a3d735e8cb0279818d783b01a,ere_68_48,a22fecf70342f73be4820b595e1fccb7,ere_68_72
cfpt_main,modern-goblin,2022-11-16T21:14:59.979Z,2022-11-16T21:15:27.568Z,29_ere_48_24-ere_48_36-ere_48_12-ere_48_48-ere_48_72-ere_48_60,6f957c279b0a29d9444c74930bbbe025,ere_48_00,84bb360a5a89528da41afd338f0fc788,ere_48_72,d9444c70bd1e98e1837ca74ee66e7be8,ere_48_48,4d22d7e83c03eac843664f96da8f744e,ere_48_60,4a32c86b56b295f87f14c483a22158b0,ere_48_12,e70dd6e18188e1134ad4774ae940c48b,ere_48_24,bca92d047c05b0d318caf2ddf10a562b,ere_48_36
cfpt_main,modern-goblin,2022-11-16T21:15:27.569Z,2022-11-16T21:16:16.388Z,10_inv_02_60-inv_02_24-inv_02_12-inv_02_48-inv_02_72-inv_02_36,b2e2b1a594a188e3e92b977e9949f17d,inv_02_00,f42398b33d58c66b41c99b99223db96f,inv_02_72,d8d00bc75477885de2a1ca083b917767,inv_02_24,959792bc94e58893af18e8118f1927b0,inv_02_60,bf6548f28b1f944922754b9150fbc7a2,inv_02_12,06b067cf5bfdd4212af4421d84ec99d8,inv_02_48,cc4df0c916cf89ea77d8c7a9b68be624,inv_02_36
cfpt_main,modern-goblin,2022-11-16T21:16:16.389Z,2022-11-16T21:17:06.269Z,14_ere_61_24-ere_61_36-ere_61_12-ere_61_60-ere_61_48-ere_61_72,38981022817f2b68e5bb5ec6dc8d64d6,ere_61_00,d75f94a61df655ecd7fedee966ea0448,ere_61_72,91650bf52c93bbfb898bb1e3f16d8621,ere_61_36,a2b01509fb4ec76afca31d36d1e317d6,ere_61_12,2d7275f4913f74bfbc7b3af0ed017a78,ere_61_48,58ce5e418a446a542e7cde0d60de1941,ere_61_60,42bfda4a99f2351ad94c0d617238e32a,ere_61_24
cfpt_main,modern-goblin,2022-11-16T21:17:06.270Z,2022-11-16T21:17:51.891Z,14_inv_67_12-inv_67_36-inv_67_48-inv_67_72-inv_67_24-inv_67_60,3a9dc4f8dc6f103271d5455533834760,inv_67_00,50079f16d2dc6e79ed9a8d901538c479,inv_67_72,90481f1bd71a25b6ef4038b6d66f331f,inv_67_12,2f249441da202e1f9aa8888771bc1783,inv_67_60,3d228248d7eff46cbbf04ebffdee0916,inv_67_24,0cdfbee6670b35ddd4f5abf7fc8898ca,inv_67_48,7cdd604ff639f71d39bf478eeb3bf0d1,inv_67_36
cfpt_main,modern-goblin,2022-11-16T21:17:51.892Z,2022-11-16T21:18:44.386Z,21_inv_61_36-inv_61_60-inv_61_24-inv_61_12-inv_61_48-inv_61_72,304031f7a5ce6bffcd6eb67d9d9e3444,inv_61_00,5fa41e60976214d5d6540df61a9d0ca8,inv_61_60,77ce46148db468582aadf4f515387906,inv_61_24,4907f3a16a65ab5ffae45c170e0e8f34,inv_61_48,bf81351dad582f3b51512098de80617b,inv_61_12,525fc04ccd8166ae3b30f8254438a45c,inv_61_72,856aae3324f4cbb72842ecc753f926aa,inv_61_36
"""
